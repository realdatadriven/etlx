<!doctype html><html lang=en-US dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content><link rel=icon href=/favicon.ico sizes=any><link rel=apple-touch-icon href=/favicon.ico><link rel=preload href=/icons/clipboard.svg as=image type=image/svg+xml><link rel=preload href=/icons/caret-down.svg as=image type=image/svg+xml><link rel=preload href=/icons/caret-right.svg as=image type=image/svg+xml><link rel=preload href=/icons/home.svg as=image type=image/svg+xml><title>Dynamic Queries | ETLX</title><meta name=description content="ETL / ELT Framework powered by DuckDB, designed to seamlessly integrate and process data from diverse sources. It leverages Markdown as a configuration medium, where YAML blocks define metadata for each data source, and embedded SQL blocks specify the extraction, transformation, and loading logic."><meta name=keywords content="ETL,ELT,Data Integration,DuckDB,Markdown,SQL,Data Processing,Framework,Data Engineering,Data Pipelines,Data Transformation,Data Science,Data Analytics,Open Source,Data Governance,Data Documentation,Data Workflows,Data Workflow Documentation,Report Automation"><meta name=author content="Real Data-Driven"><meta name=language content="en-US"><link rel=canonical href=https://realdatadriven.github.io/etlx/advanced/dynamic-queries/><link rel=manifest href=https://realdatadriven.github.io/etlx/manifest.webmanifest><meta property="og:title" content="Dynamic Queries | ETLX"><meta property="og:description" content="ETL / ELT Framework powered by DuckDB, designed to seamlessly integrate and process data from diverse sources. It leverages Markdown as a configuration medium, where YAML blocks define metadata for each data source, and embedded SQL blocks specify the extraction, transformation, and loading logic."><meta property="og:type" content="article"><meta property="og:url" content="https://realdatadriven.github.io/etlx/advanced/dynamic-queries/"><meta property="og:locale" content="en-US"><meta property="og:site_name" content="ETLX"><meta property="og:image" content="https://realdatadriven.github.io/favicon.ico"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta property="og:image:alt" content="ETLX logo"><meta property="article:author" content="Real Data-Driven"><meta property="article:section" content="advanced"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Dynamic Queries | ETLX"><meta name=twitter:description content="ETL / ELT Framework powered by DuckDB, designed to seamlessly integrate and process data from diverse sources. It leverages Markdown as a configuration medium, where YAML blocks define metadata for each data source, and embedded SQL blocks specify the extraction, transformation, and loading logic."><meta name=twitter:image content="https://realdatadriven.github.io/favicon.ico"><meta name=twitter:image:alt content="ETLX logo"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","@id":"https:\/\/realdatadriven.github.io\/etlx\/advanced\/dynamic-queries\/#article","headline":"Dynamic Queries","description":"ETL \/ ELT Framework powered by DuckDB, designed to seamlessly integrate and process data from diverse sources. It leverages Markdown as a configuration medium, where YAML blocks define metadata for each data source, and embedded SQL blocks specify the extraction, transformation, and loading logic.","url":"https:\/\/realdatadriven.github.io\/etlx\/advanced\/dynamic-queries\/","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","wordCount":449,"timeRequired":"PT3M","author":{"@type":"Organization","@id":"https:\/\/realdatadriven.github.io\/etlx\/#organization"},"publisher":{"@type":"Organization","@id":"https:\/\/realdatadriven.github.io\/etlx\/#organization"},"isPartOf":{"@id":"https:\/\/realdatadriven.github.io\/etlx\/#website"}},{"@type":"BreadcrumbList","@id":"https:\/\/realdatadriven.github.io\/etlx\/advanced\/dynamic-queries\/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"ETLX","item":"https:\/\/realdatadriven.github.io\/etlx\/"},{"@type":"ListItem","position":2,"name":"Advanced","item":"https:\/\/realdatadriven.github.io\/etlx\/advanced\/"},{"@type":"ListItem","position":3,"name":"Dynamic Queries","item":"https:\/\/realdatadriven.github.io\/etlx\/advanced\/dynamic-queries\/"}]},{"@type":"WebSite","@id":"https:\/\/realdatadriven.github.io\/etlx\/#website","url":"https:\/\/realdatadriven.github.io\/etlx\/","name":"ETLX","publisher":{"@id":"https:\/\/realdatadriven.github.io\/etlx\/#organization"}}]}</script><link rel=stylesheet href=/etlx/css/style.min.c8b8d34bfceb040e8957f73bca811dcf496446066a07c4298993517af10bc79e.css integrity="sha256-yLjTS/zrBA6JV/c7yoEdz0lkRgZqB8QpiZNRevELx54=" crossorigin=anonymous></head><body class="has-toc has-sidebar"><a class=skip-link href=#main-content>Skip to main content</a><header class=header><button class=header__sidebar--toggle data-action=toggle-sidebar title="Toggle sidebar"></button><a class=header__title href=/>ETLX</a><nav class=menu><ul><li><a href=/etlx/>Home</a></li><li><a href=/etlx/introduction/>Introduction</a></li><li><a href=/etlx/quick-start/>Quick Start</a></li><li><a href=/etlx/configuration/>Configuration</a></li><li><a href=/etlx/advanced/>Advanced</a></li><li><a href=/etlx/embedding/>Embedding</a></li><li><a href=/etlx/future/>Future</a></li><li><a href=/etlx/license/>License</a></li></ul></nav><button class=header__menu--toggle data-action=toggle-menu title="Toggle menu"></button></header><div class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><a class="crumb home" href=https://realdatadriven.github.io/etlx/ title=ETLX itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><meta itemprop=item content="https://realdatadriven.github.io/etlx/"><span itemprop=name>ETLX</span><meta itemprop=position content="1"></a><a class=crumb href=https://realdatadriven.github.io/etlx/advanced/ itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><meta itemprop=item content="https://realdatadriven.github.io/etlx/advanced/"><span itemprop=name>Advanced</span><meta itemprop=position content="2"></a><span class="crumb current" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><meta itemprop=item content="https://realdatadriven.github.io/etlx/advanced/dynamic-queries/"><span itemprop=name>Dynamic Queries</span><meta itemprop=position content="3"></span></div><aside class=sidebar><div class=sidebar__content><button class=sidebar__close data-action=toggle-sidebar title="Close sidebar"></button><div class=sidebar__section--search><input name=q placeholder=Search... type=search><ul class=sidebar__section--search-results></ul></div><nav class=sidebar__nav><ul class=sidebar__section--pages><li><a class="sidebar__link is-active" href=https://realdatadriven.github.io/etlx/advanced/dynamic-queries/>Dynamic Queries</a></li><li><a class=sidebar__link href=https://realdatadriven.github.io/etlx/advanced/conditional-execution/>Conditional Execution</a></li><li><a class=sidebar__link href=https://realdatadriven.github.io/etlx/advanced/runs-as/>runs_as override</a></li></ul></nav></div><footer class=footer><div class=footer__social-links><a href=https://github.com/realdatadriven/etlx target=_blank rel="noopener noreferrer"><div title=GitHub><div aria-hidden=true><svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M5.315 2.1c.791-.113 1.9.145 3.333.966l.272.161.16.1.397-.083a13.3 13.3.0 014.59-.08l.456.08.396.083.161-.1c1.385-.84 2.487-1.17 3.322-1.148l.164.008.147.017.076.014.05.011.144.047a1 1 0 01.53.514 5.2 5.2.0 01.397 2.91l-.047.267-.046.196.123.163c.574.795.93 1.728 1.03 2.707l.023.295L21 9.5c0 3.855-1.659 5.883-4.644 6.68l-.245.061-.132.029.014.161.008.157.004.365-.002.213L16 21a1 1 0 01-.883.993L15 22H9a1 1 0 01-.993-.883L8 21v-.734c-1.818.26-3.03-.424-4.11-1.878l-.535-.766c-.28-.396-.455-.579-.589-.644l-.048-.019a1 1 0 01.564-1.918c.642.188 1.074.568 1.57 1.239l.538.769c.76 1.079 1.36 1.459 2.609 1.191L8 17.562l-.018-.168a5 5 0 01-.021-.824l.017-.185.019-.12-.108-.024c-2.976-.71-4.703-2.573-4.875-6.139l-.01-.31L3 9.5a5.6 5.6.0 01.908-3.051l.152-.222.122-.163-.045-.196a5.2 5.2.0 01.145-2.642l.1-.282.106-.253a1 1 0 01.529-.514l.144-.047z"/></svg></div></div></a></div></footer></aside><div class=sidebar__backdrop data-action=toggle-sidebar></div><main id=main-content><h1>Dynamic Queries</h1><h1 id=dynamic-query-generation-get_dyn_queries>Dynamic Query Generation (<code>get_dyn_queries[...]</code>)</h1><p>In some advanced ETL workflows, you may need to dynamically generate SQL queries based on metadata or schema differences between the source and destination databases.</p><hr><h2 id=-why-use-dynamic-queries><strong>ğŸ”¹ Why Use Dynamic Queries?</strong></h2><p>âœ… <strong>Schema Flexibility</strong> â€“ Automatically adapt to schema changes in the source system.<br>âœ… <strong>Self-Evolving Workflows</strong> â€“ ETL jobs can generate and execute additional SQL queries as needed.<br>âœ… <strong>Automation</strong> â€“ Reduces the need for manual intervention when new columns appear.</p><h2 id=-how><strong>ğŸ”¹ How <code>get_dyn_queries[query_name](runs_before,runs_after)</code> Works</strong></h2><ul><li>Dynamic queries are executed using the <strong><code>get_dyn_queries[query_name](runs_before,runs_after)</code></strong> pattern.</li><li>During execution, <strong>ETLX runs the query</strong> <code>query_name</code> and <strong>retrieves dynamically generated queries</strong>.</li><li>The <strong>resulting queries are then executed automatically</strong>.</li></ul><h2 id=-example-auto-adding-missing-columns><strong>ğŸ›  Example: Auto-Adding Missing Columns</strong></h2><p>This example <strong>checks for new columns in a JSON file</strong> and <strong>adds them to the destination table</strong>.</p><h3 id=-markdown-configuration-for><strong>ğŸ“„ Markdown Configuration for <code>get_dyn_queries[query_name](runs_before,runs_after)</code></strong></h3><blockquote><p>If the <code>query_name</code> depends on attaching and detaching the main db where it will run, those should be passed as dependencies, because the dynamic queries are generate before any other query and put in the list for the list where it is to be executed, to be a simpler flow, but they are optional otherwise.</p></blockquote><figure class=code-block role=figure aria-label="markdown code snippet"><button class=highlight__copy title="Copy to clipboard"></button><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>``<span class=sb>`yaml metadata
</span></span></span><span class=line><span class=cl><span class=sb>...
</span></span></span><span class=line><span class=cl><span class=sb>connection: &#34;duckdb:&#34;
</span></span></span><span class=line><span class=cl><span class=sb>before_sql:
</span></span></span><span class=line><span class=cl><span class=sb>  - ...
</span></span></span><span class=line><span class=cl><span class=sb>  - get_dyn_queries[create_missing_columns]  # Generates queries defined in `</span>create_missing_columns<span class=sb>` and  Executes them
</span></span></span><span class=line><span class=cl><span class=sb>..
</span></span></span><span class=line><span class=cl><span class=sb>`</span>`<span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>**ğŸ“œ SQL Query (Generating Missing Columns)**
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>`</span>`<span class=sb>`sql
</span></span></span><span class=line><span class=cl><span class=sb>-- create_missing_columns
</span></span></span><span class=line><span class=cl><span class=sb>WITH source_columns AS (
</span></span></span><span class=line><span class=cl><span class=sb>    SELECT column_name, column_type 
</span></span></span><span class=line><span class=cl><span class=sb>    FROM (DESCRIBE SELECT * FROM read_json(&#39;&lt;fname&gt;&#39;))
</span></span></span><span class=line><span class=cl><span class=sb>),
</span></span></span><span class=line><span class=cl><span class=sb>destination_columns AS (
</span></span></span><span class=line><span class=cl><span class=sb>    SELECT column_name, data_type as column_type
</span></span></span><span class=line><span class=cl><span class=sb>    FROM duckdb_columns 
</span></span></span><span class=line><span class=cl><span class=sb>    WHERE table_name = &#39;&lt;table&gt;&#39;
</span></span></span><span class=line><span class=cl><span class=sb>),
</span></span></span><span class=line><span class=cl><span class=sb>missing_columns AS (
</span></span></span><span class=line><span class=cl><span class=sb>    SELECT s.column_name, s.column_type
</span></span></span><span class=line><span class=cl><span class=sb>    FROM source_columns s
</span></span></span><span class=line><span class=cl><span class=sb>    LEFT JOIN destination_columns d ON s.column_name = d.column_name
</span></span></span><span class=line><span class=cl><span class=sb>    WHERE d.column_name IS NULL
</span></span></span><span class=line><span class=cl><span class=sb>)
</span></span></span><span class=line><span class=cl><span class=sb>SELECT &#39;ALTER TABLE &#34;&lt;table&gt;&#34; ADD COLUMN &#34;&#39; || column_name || &#39;&#34; &#39; || column_type || &#39;;&#39; AS query
</span></span></span><span class=line><span class=cl><span class=sb>FROM missing_columns
</span></span></span><span class=line><span class=cl><span class=sb>WHERE (SELECT COUNT(*) FROM destination_columns) &gt; 0;
</span></span></span><span class=line><span class=cl><span class=sb>`</span>``</span></span></code></pre></td></tr></table></div></div></figure><hr><h2 id=-execution-flow><strong>ğŸ›  Execution Flow</strong></h2><p>1ï¸âƒ£ <strong>Extract column metadata from the input (in this case a json file, but it could be a table or any other valid query).</strong><br>2ï¸âƒ£ <strong>Check which columns are missing in the destination table (<code>&lt;table></code>).</strong><br>3ï¸âƒ£ <strong>Generate <code>ALTER TABLE</code> statements for adding missing columns, and replaces the <code>- get_dyn_queries[create_missing_columns]</code> with the the generated queries</strong><br>4ï¸âƒ£ <strong>Runs the workflow with dynamically generated queries against the destination connection.</strong></p><h2 id=-key-features><strong>ğŸ”¹ Key Features</strong></h2><p>âœ” <strong>Fully automated schema updates</strong><br>âœ” <strong>Works with flexible schema data (e.g., JSON, CSV, Parquet, etc.)</strong><br>âœ” <strong>Reduces manual maintenance when source schemas evolve</strong><br>âœ” <strong>Ensures destination tables always match source structure</strong></p><hr><p><strong>With <code>get_dyn_queries[...]</code>, your ETLX workflows can now dynamically evolve with changing data structures!</strong></p><a class=edit-link href=https://github.com/realdatadriven/etlx/tree/main/docs/content/advanced/dynamic-queries.md rel="noopener noreferrer" target=_blank><svg width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 20h4L18.5 9.5a2.828 2.828.0 10-4-4L4 16zm9.5-13.5 4 4"/></svg>
<span>Improve this page</span></a></main><aside id=toc class=toc><div class=toc__header data-action=toggle-toc><h3 class=toc__title>On this page</h3><button class=toc__toggle aria-label="Toggle table of contents"></button></div><div class=toc__content><nav id=TableOfContents><ul><li><a href=#-why-use-dynamic-queries><strong>ğŸ”¹ Why Use Dynamic Queries?</strong></a></li><li><a href=#-how><strong>ğŸ”¹ How <code>get_dyn_queries[query_name](runs_before,runs_after)</code> Works</strong></a></li><li><a href=#-example-auto-adding-missing-columns><strong>ğŸ›  Example: Auto-Adding Missing Columns</strong></a><ul><li><a href=#-markdown-configuration-for><strong>ğŸ“„ Markdown Configuration for <code>get_dyn_queries[query_name](runs_before,runs_after)</code></strong></a></li></ul></li><li><a href=#-execution-flow><strong>ğŸ›  Execution Flow</strong></a></li><li><a href=#-key-features><strong>ğŸ”¹ Key Features</strong></a></li></ul></nav></div></aside><script defer crossorigin=anonymous integrity="sha256-KXMijDfasiR2erJ0tgywvcZ1CHvBNdFv6ZTL8PGWBIE=" src=/etlx/js/bundle.2973228c37dab224767ab274b60cb0bdc675087bc135d16fe994cbf0f1960481.js></script></body></html>