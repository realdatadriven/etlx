<!DOCTYPE html>
<html
  lang="en-US"
  dir="ltr"
><head><script src="/etlx/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=etlx/livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#000000">
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="/favicon.ico"><link rel="preload" href="/icons/clipboard.svg" as="image" type="image/svg+xml" />
<link rel="preload" href="/icons/caret-down.svg" as="image" type="image/svg+xml" />
<link rel="preload" href="/icons/caret-right.svg" as="image" type="image/svg+xml" />
<link rel="preload" href="/icons/home.svg" as="image" type="image/svg+xml" />
<title>Dynamic Queries | Plume</title>
  <meta name="description" content="The Plume Hugo documentation theme">
  <meta name="keywords" content="Plume, Hugo, documentation, theme">
  <meta name="author" content="Dobefu">
  <meta name="language" content="en-US">

  <link rel="canonical" href="http://localhost:1313/etlx/advanced/dynamic-queries/">
  <link rel="manifest" href="http://localhost:1313/etlx/manifest.webmanifest"><meta property="og:title" content="Dynamic Queries | Plume">
  <meta property="og:description" content="The Plume Hugo documentation theme">
  <meta property="og:type" content="article">
  <meta property="og:url" content="http://localhost:1313/etlx/advanced/dynamic-queries/">
  <meta property="og:locale" content="en-US">
  <meta property="og:site_name" content="Plume">
  <meta property="og:image" content="http://localhost:1313/favicon.ico">
  <meta property="og:image:width" content="512">
  <meta property="og:image:height" content="512">
  <meta property="og:image:alt" content="Plume logo"><meta property="article:author" content="Dobefu"><meta property="article:section" content="advanced"><meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Dynamic Queries | Plume">
  <meta name="twitter:description" content="The Plume Hugo documentation theme">
  <meta name="twitter:image" content="http://localhost:1313/favicon.ico">
  <meta name="twitter:image:alt" content="Plume logo"><script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "TechArticle",
        "@id": "http:\/\/localhost:1313\/etlx\/advanced\/dynamic-queries\/#article",
        "headline": "Dynamic Queries",
        "description": "The Plume Hugo documentation theme",
        "url": "http:\/\/localhost:1313\/etlx\/advanced\/dynamic-queries\/",
        "datePublished": "0001-01-01T00:00:00Z",
        "dateModified": "0001-01-01T00:00:00Z",
        "wordCount":  473 ,
        "timeRequired": "PT3M",
        "author": {
          "@type": "Organization",
          "@id": "http:\/\/localhost:1313\/etlx\/#organization"
        },
        "publisher": {
          "@type": "Organization",
          "@id": "http:\/\/localhost:1313\/etlx\/#organization"
        },
        "isPartOf": {
          "@id": "http:\/\/localhost:1313\/etlx\/#website"
        }
      },{
        "@type": "BreadcrumbList",
        "@id": "http:\/\/localhost:1313\/etlx\/advanced\/dynamic-queries\/#breadcrumb",
        "itemListElement": [{
              "@type": "ListItem",
              "position":  1 ,
              "name": "Plume Documentation Theme",
              "item": "http:\/\/localhost:1313\/etlx\/"
            },{
              "@type": "ListItem",
              "position":  2 ,
              "name": "Advanced",
              "item": "http:\/\/localhost:1313\/etlx\/advanced\/"
            },{
              "@type": "ListItem",
              "position":  3 ,
              "name": "Dynamic Queries",
              "item": "http:\/\/localhost:1313\/etlx\/advanced\/dynamic-queries\/"
            }]
      },{
        "@type": "WebSite",
        "@id": "http:\/\/localhost:1313\/etlx\/#website",
        "url": "http:\/\/localhost:1313\/etlx\/",
        "name": "Plume",
        "publisher": {
          "@id": "http:\/\/localhost:1313\/etlx\/#organization"
        }
      }
    ]
  }
</script>
<link rel="stylesheet" href="/etlx/css/_reset.css"><link rel="stylesheet" href="/etlx/css/base.css"><link rel="stylesheet" href="/etlx/css/breadcrumbs.css"><link rel="stylesheet" href="/etlx/css/card.css"><link rel="stylesheet" href="/etlx/css/content.css"><link rel="stylesheet" href="/etlx/css/edit-link.css"><link rel="stylesheet" href="/etlx/css/fonts.css"><link rel="stylesheet" href="/etlx/css/footer.css"><link rel="stylesheet" href="/etlx/css/form.css"><link rel="stylesheet" href="/etlx/css/header.css"><link rel="stylesheet" href="/etlx/css/headings.css"><link rel="stylesheet" href="/etlx/css/highlight-copy.css"><link rel="stylesheet" href="/etlx/css/highlight.css"><link rel="stylesheet" href="/etlx/css/page.css"><link rel="stylesheet" href="/etlx/css/search.css"><link rel="stylesheet" href="/etlx/css/sidebar.css"><link rel="stylesheet" href="/etlx/css/skip-link.css"><link rel="stylesheet" href="/etlx/css/table.css"><link rel="stylesheet" href="/etlx/css/toc.css"><link rel="stylesheet" href="/etlx/css/variables.css"></head>
<body
    class="has-toc has-sidebar"
  ><a class="skip-link" href="#main-content">Skip to main content</a>
<header class="header"><button
      class="header__sidebar--toggle"
      data-action="toggle-sidebar"
      title="Toggle sidebar"
    ></button><a class="header__title" href="/">Plume</a><nav class="menu">
    <ul><li>
      <a href="/etlx/">Home</a></li><li>
      <a href="/etlx/docs/">Documentation</a></li><li>
      <a href="/etlx/introduction/">Introduction</a></li><li>
      <a href="/etlx/quick-start/">Quick Start</a></li><li>
      <a href="/etlx/configuration/">Configuration</a></li><li>
      <a href="/etlx/advanced/">Advanced</a></li><li>
      <a href="/etlx/embedding/">Embedding</a></li><li>
      <a href="/etlx/future/">Future</a></li><li>
      <a href="/etlx/license/">License</a></li></ul>
  </nav><button
    class="header__menu--toggle"
    data-action="toggle-menu"
    title="Toggle menu"
  ></button>
</header>
<div class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList"><a
          class="crumb home"
          href="http://localhost:1313/etlx/"
          title="Plume Documentation Theme"
          itemprop="itemListElement"
          itemscope
          itemtype="https://schema.org/ListItem"
        ><meta itemprop="item" content="http://localhost:1313/etlx/"><span itemprop="name">Plume Documentation Theme</span><meta itemprop="position" content="1"></a><a
          class="crumb"
          href="http://localhost:1313/etlx/advanced/"
          itemprop="itemListElement"
          itemscope
          itemtype="https://schema.org/ListItem"
        ><meta itemprop="item" content="http://localhost:1313/etlx/advanced/"><span itemprop="name">Advanced</span><meta itemprop="position" content="2"></a><span
          class="crumb current"
          itemprop="itemListElement"
          itemscope
          itemtype="https://schema.org/ListItem"
        ><meta itemprop="item" content="http://localhost:1313/etlx/advanced/dynamic-queries/"><span itemprop="name">Dynamic Queries</span><meta itemprop="position" content="3"></span></div><aside class="sidebar">
    <div class="sidebar__content">
      <button
        class="sidebar__close"
        data-action="toggle-sidebar"
        title="Close sidebar"
      ></button>

      <div class="sidebar__section--search">
        <input
          name="q"
          placeholder="Search..."
          type="search"
        />
        <ul class="sidebar__section--search-results"></ul>
      </div>

      <nav class="sidebar__nav">
        <ul class="sidebar__section--pages"><li>
      <a
        class="sidebar__link is-active"
        href="http://localhost:1313/etlx/advanced/dynamic-queries/"
      >Dynamic Queries</a>
    </li><li>
      <a
        class="sidebar__link"
        href="http://localhost:1313/etlx/advanced/conditional-execution/"
      >Conditional Execution</a>
    </li><li>
      <a
        class="sidebar__link"
        href="http://localhost:1313/etlx/advanced/runs-as/"
      >runs_as override</a>
    </li></ul>
      </nav>
    </div><footer class="footer">
    <div class="footer__social-links"><a href="https://github.com/Dobefu/hugo-theme-plume" target="_blank" rel="noopener noreferrer"><div title="GitHub">
              <div aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M5.315 2.1c.791-.113 1.9.145 3.333.966l.272.161l.16.1l.397-.083a13.3 13.3 0 0 1 4.59-.08l.456.08l.396.083l.161-.1c1.385-.84 2.487-1.17 3.322-1.148l.164.008l.147.017l.076.014l.05.011l.144.047a1 1 0 0 1 .53.514a5.2 5.2 0 0 1 .397 2.91l-.047.267l-.046.196l.123.163c.574.795.93 1.728 1.03 2.707l.023.295L21 9.5c0 3.855-1.659 5.883-4.644 6.68l-.245.061l-.132.029l.014.161l.008.157l.004.365l-.002.213L16 21a1 1 0 0 1-.883.993L15 22H9a1 1 0 0 1-.993-.883L8 21v-.734c-1.818.26-3.03-.424-4.11-1.878l-.535-.766c-.28-.396-.455-.579-.589-.644l-.048-.019a1 1 0 0 1 .564-1.918c.642.188 1.074.568 1.57 1.239l.538.769c.76 1.079 1.36 1.459 2.609 1.191L8 17.562l-.018-.168a5 5 0 0 1-.021-.824l.017-.185l.019-.12l-.108-.024c-2.976-.71-4.703-2.573-4.875-6.139l-.01-.31L3 9.5a5.6 5.6 0 0 1 .908-3.051l.152-.222l.122-.163l-.045-.196a5.2 5.2 0 0 1 .145-2.642l.1-.282l.106-.253a1 1 0 0 1 .529-.514l.144-.047z"/></svg>
</div>
            </div></a></div>
  </footer></aside>

  <div class="sidebar__backdrop" data-action="toggle-sidebar"></div><main id="main-content"><h1>Dynamic Queries</h1><h3 id="dynamic-query-generation-get_dyn_queries">Dynamic Query Generation (<code>get_dyn_queries[...]</code>)</h3>
<p>In some advanced ETL workflows, you may need to dynamically generate SQL queries based on metadata or schema differences between the source and destination databases.</p>
<hr>
<h4 id="-why-use-dynamic-queries"><strong>üîπ Why Use Dynamic Queries?</strong></h4>
<p>‚úÖ <strong>Schema Flexibility</strong> ‚Äì Automatically adapt to schema changes in the source system.<br>
‚úÖ <strong>Self-Evolving Workflows</strong> ‚Äì ETL jobs can generate and execute additional SQL queries as needed.<br>
‚úÖ <strong>Automation</strong> ‚Äì Reduces the need for manual intervention when new columns appear.</p>
<h4 id="-how"><strong>üîπ How <code>get_dyn_queries[query_name](runs_before,runs_after)</code> Works</strong></h4>
<ul>
<li>Dynamic queries are executed using the <strong><code>get_dyn_queries[query_name](runs_before,runs_after)</code></strong> pattern.</li>
<li>During execution, <strong>ETLX runs the query</strong> <code>query_name</code> and <strong>retrieves dynamically generated queries</strong>.</li>
<li>The <strong>resulting queries are then executed automatically</strong>.</li>
</ul>
<h4 id="-example-auto-adding-missing-columns"><strong>üõ† Example: Auto-Adding Missing Columns</strong></h4>
<p>This example <strong>checks for new columns in a JSON file</strong> and <strong>adds them to the destination table</strong>.</p>
<h5 id="-markdown-configuration-for"><strong>üìÑ Markdown Configuration for <code>get_dyn_queries[query_name](runs_before,runs_after)</code></strong></h5>
<blockquote>
<p>If the <code>query_name</code> depends on attaching and detaching the main db where it will run, those should be passed as dependencies, because the dynamic queries are generate before any other query and put in the list for the list where it is to be executed, to be a simpler flow, but they are optional otherwise.</p>
</blockquote>
<figure class="code-block" role="figure" aria-label="markdown code snippet">
  <button class="highlight__copy" title="Copy to clipboard"></button><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">``<span class="sb">`yaml metadata
</span></span></span><span class="line"><span class="cl"><span class="sb">...
</span></span></span><span class="line"><span class="cl"><span class="sb">connection: &#34;duckdb:&#34;
</span></span></span><span class="line"><span class="cl"><span class="sb">before_sql:
</span></span></span><span class="line"><span class="cl"><span class="sb">  - ...
</span></span></span><span class="line"><span class="cl"><span class="sb">  - get_dyn_queries[create_missing_columns]  # Generates queries defined in `</span>create_missing_columns<span class="sb">` and  Executes them
</span></span></span><span class="line"><span class="cl"><span class="sb">..
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>`<span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">**üìú SQL Query (Generating Missing Columns)**
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>`<span class="sb">`sql
</span></span></span><span class="line"><span class="cl"><span class="sb">-- create_missing_columns
</span></span></span><span class="line"><span class="cl"><span class="sb">WITH source_columns AS (
</span></span></span><span class="line"><span class="cl"><span class="sb">    SELECT column_name, column_type 
</span></span></span><span class="line"><span class="cl"><span class="sb">    FROM (DESCRIBE SELECT * FROM read_json(&#39;&lt;fname&gt;&#39;))
</span></span></span><span class="line"><span class="cl"><span class="sb">),
</span></span></span><span class="line"><span class="cl"><span class="sb">destination_columns AS (
</span></span></span><span class="line"><span class="cl"><span class="sb">    SELECT column_name, data_type as column_type
</span></span></span><span class="line"><span class="cl"><span class="sb">    FROM duckdb_columns 
</span></span></span><span class="line"><span class="cl"><span class="sb">    WHERE table_name = &#39;&lt;table&gt;&#39;
</span></span></span><span class="line"><span class="cl"><span class="sb">),
</span></span></span><span class="line"><span class="cl"><span class="sb">missing_columns AS (
</span></span></span><span class="line"><span class="cl"><span class="sb">    SELECT s.column_name, s.column_type
</span></span></span><span class="line"><span class="cl"><span class="sb">    FROM source_columns s
</span></span></span><span class="line"><span class="cl"><span class="sb">    LEFT JOIN destination_columns d ON s.column_name = d.column_name
</span></span></span><span class="line"><span class="cl"><span class="sb">    WHERE d.column_name IS NULL
</span></span></span><span class="line"><span class="cl"><span class="sb">)
</span></span></span><span class="line"><span class="cl"><span class="sb">SELECT &#39;ALTER TABLE &#34;&lt;table&gt;&#34; ADD COLUMN &#34;&#39; || column_name || &#39;&#34; &#39; || column_type || &#39;;&#39; AS query
</span></span></span><span class="line"><span class="cl"><span class="sb">FROM missing_columns
</span></span></span><span class="line"><span class="cl"><span class="sb">WHERE (SELECT COUNT(*) FROM destination_columns) &gt; 0;
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>`<span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">---
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">#### **üõ† Execution Flow**
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">1Ô∏è‚É£ **Extract column metadata from the input (in this case a json file, but it could be a table or any other valid query).**  
</span></span></span><span class="line"><span class="cl"><span class="sb">2Ô∏è‚É£ **Check which columns are missing in the destination table (`</span>&lt;table&gt;<span class="sb">`).**  
</span></span></span><span class="line"><span class="cl"><span class="sb">3Ô∏è‚É£ **Generate `</span>ALTER TABLE<span class="sb">` statements for adding missing columns, and replaces the `</span>- get_dyn_queries[create_missing_columns]<span class="sb">` with the the generated queries**  
</span></span></span><span class="line"><span class="cl"><span class="sb">4Ô∏è‚É£ **Runs the workflow with dynamically generated queries against the destination connection.**
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">#### **üîπ Key Features**
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">‚úî **Fully automated schema updates**  
</span></span></span><span class="line"><span class="cl"><span class="sb">‚úî **Works with flexible schema data (e.g., JSON, CSV, Parquet, etc.)**  
</span></span></span><span class="line"><span class="cl"><span class="sb">‚úî **Reduces manual maintenance when source schemas evolve**  
</span></span></span><span class="line"><span class="cl"><span class="sb">‚úî **Ensures destination tables always match source structure**
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">---
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">**With `</span>get_dyn_queries[...]`, your ETLX workflows can now dynamically evolve with changing data structures!**</span></span></code></pre></td></tr></table>
</div>
</div></figure>
<a
  class="edit-link"
  href="https://github.com/Dobefu/hugo-theme-plume/tree/main/exampleSite/content/advanced/dynamic-queries.md"
  rel="noopener noreferrer"
  target="_blank"
><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 20h4L18.5 9.5a2.828 2.828 0 1 0-4-4L4 16zm9.5-13.5l4 4"/></svg>
<span>Improve this page</span>
</a>
</main><aside id="toc" class="toc">
        <div class="toc__header" data-action="toggle-toc">
          <h3 class="toc__title">On this page</h3>

          <button
            class="toc__toggle"
            aria-label="Toggle table of contents"
          ></button>
        </div>

        <div class="toc__content"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#dynamic-query-generation-get_dyn_queries">Dynamic Query Generation (<code>get_dyn_queries[...]</code>)</a>
          <ul>
            <li><a href="#-why-use-dynamic-queries"><strong>üîπ Why Use Dynamic Queries?</strong></a></li>
            <li><a href="#-how"><strong>üîπ How <code>get_dyn_queries[query_name](runs_before,runs_after)</code> Works</strong></a></li>
            <li><a href="#-example-auto-adding-missing-columns"><strong>üõ† Example: Auto-Adding Missing Columns</strong></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
      </aside><script defer src="/etlx/js/bundle.js"></script></body>
</html>
